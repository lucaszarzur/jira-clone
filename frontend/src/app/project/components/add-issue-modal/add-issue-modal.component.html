<div class="px-8 py-5">
    <div class="flex items-center py-3 text-textDarkest">
        <div class="text-xl">
            {{ isSubtask ? 'Create subtask' : 'Create issue' }}
        </div>
        <div class="flex-auto"></div>
        <j-button icon="times"
                  [iconSize]="24"
                  (click)="closeModal()"
                  [className]="'btn-empty'">
        </j-button>
    </div>
    <div *ngIf="isSubtask && parentIssue" class="parent-issue-info">
        <div class="flex items-center text-13 text-textMedium mb-3 p-3 bg-backgroundLight rounded">
            <svg-icon [name]="parentIssue.type.toLowerCase()" [size]="16" class="mr-2"></svg-icon>
            <span class="font-medium">Parent issue:</span>
            <span class="ml-2">{{ parentIssue.title }}</span>
        </div>
    </div>
    <form class="issue-form"
          [formGroup]="issueForm">
        <div class="form-group">
            <label class="label">
                Issue type
            </label>
            <issue-type-select [control]="f?.type"></issue-type-select>
        </div>
        <div class="mt-3 form-group" *ngIf="f?.type?.value === 'Subtask' && !parentIssueId">
            <label class="label">
                Parent issue <span class="text-red-500">*</span>
            </label>
            <nz-select class="w-full"
                       formControlName="parentIssueId"
                       nzShowSearch
                       nzPlaceHolder="Select a parent issue">
                <nz-option *ngFor="let issue of availableParentIssues$ | async"
                           [nzValue]="issue.id"
                           [nzLabel]="issue.title">
                    <div class="flex items-center">
                        <svg-icon [name]="issue.type.toLowerCase()" [size]="16" class="mr-2"></svg-icon>
                        <span class="text-13">{{ issue.type }}-{{ issue.id }}: {{ issue.title }}</span>
                    </div>
                </nz-option>
            </nz-select>
        </div>
        <div class="mt-3 form-group">
            <label class="label">
                Issue priority
            </label>
            <issue-priority-select [control]="f?.priority"></issue-priority-select>
        </div>
        <div class="mt-3 form-group">
            <label class="label">
                Short summary
            </label>
            <input class="form-input"
                   formControlName="title"
                   jAutofocus
                   [timerDelay]="500" />
        </div>
        <div class="mt-3 form-group">
            <label class="label">
                Description
            </label>
            <quill-editor class="content-editor"
                          [styles]="{'min-height': '120px'}"
                          [modules]="editorOptions"
                          formControlName="description"
                          [placeholder]="''">
            </quill-editor>
        </div>
        <div class="mt-3 form-group">
            <label class="label">
                Reporter
            </label>
            <issue-reporter-select [control]="f?.reporterId"
                                   [users]="reporterUsers$ | async">
            </issue-reporter-select>
        </div>
        <div class="mt-3 form-group">
            <label class="label">
                Assignees
            </label>
            <issue-assignees-select [control]="f.userIds"
                                    [users]="assignees$ | async">
            </issue-assignees-select>
        </div>
        <div class="mt-5 form-group form-action">
            <j-button className="btn-primary mr-2"
                      type="submit"
                      [disabled]="issueForm?.invalid"
                      (click)="submitForm()">
                {{ isSubtask ? 'Create Subtask' : 'Create Issue' }}
            </j-button>
            <j-button className="btn-empty"
                      (click)="cancel()">
                Cancel
            </j-button>
        </div>
    </form>
</div>