<div class="project-permissions-container">
  <nz-card>
    <div class="card-header">
      <h2>Project Permissions</h2>
      <p class="description">Manage who has access to this project and their roles</p>
    </div>

    <!-- Add User Form -->
    <div class="add-user-section">
      <h3>Add User</h3>
      <form [formGroup]="addUserForm" (ngSubmit)="addUser()" class="add-user-form">
        <div class="form-row">
          <div class="form-group">
            <label for="email">Email</label>
            <input 
              nz-input 
              id="email" 
              formControlName="email" 
              placeholder="Enter user's email"
            >
            <div *ngIf="addUserForm.get('email').invalid && addUserForm.get('email').touched" class="error-message">
              <span *ngIf="addUserForm.get('email').errors?.required">Email is required</span>
              <span *ngIf="addUserForm.get('email').errors?.email">Please enter a valid email</span>
            </div>
          </div>

          <div class="form-group">
            <label for="role">Role</label>
            <nz-select 
              id="role" 
              formControlName="role" 
              nzPlaceHolder="Select role"
            >
              <nz-option nzValue="admin" nzLabel="Admin"></nz-option>
              <nz-option nzValue="member" nzLabel="Member"></nz-option>
              <nz-option nzValue="viewer" nzLabel="Viewer"></nz-option>
            </nz-select>
          </div>

          <div class="form-actions">
            <button 
              nz-button 
              nzType="primary" 
              [nzLoading]="isAddingUser" 
              [disabled]="addUserForm.invalid || isAddingUser"
            >
              Add User
            </button>
          </div>
        </div>
      </form>
    </div>

    <!-- Users List -->
    <div class="users-section">
      <h3>Project Members</h3>
      <nz-table
        #usersTable
        [nzData]="permissions"
        [nzLoading]="isLoading"
        [nzShowPagination]="false"
      >
        <thead>
          <tr>
            <th>User</th>
            <th>Role</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let permission of usersTable.data">
            <td>
              <div class="user-info">
                <nz-avatar [nzSrc]="permission.user.avatarUrl"></nz-avatar>
                <div class="user-details">
                  <div class="user-name">{{ permission.user.name }}</div>
                  <div class="user-email">{{ permission.user.email }}</div>
                </div>
              </div>
            </td>
            <td>
              <nz-select
                [ngModel]="permission.role"
                (ngModelChange)="updateUserRole(permission.userId, $event)"
                [nzDisabled]="permission.role === 'admin'"
              >
                <nz-option nzValue="admin" nzLabel="Admin"></nz-option>
                <nz-option nzValue="member" nzLabel="Member"></nz-option>
                <nz-option nzValue="viewer" nzLabel="Viewer"></nz-option>
              </nz-select>
            </td>
            <td>
              <button 
                nz-button 
                nzType="text" 
                nzDanger
                [disabled]="permission.role === 'admin'"
                (click)="removeUser(permission.userId)"
              >
                Remove
              </button>
            </td>
          </tr>
        </tbody>
      </nz-table>
    </div>
  </nz-card>
</div> 